<!DOCTYPE html>
<html>
<head>
    <title>Order History</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<nav class="navbar navbar-dark bg-dark px-4 navbar-expand-sm">
    <a class="navbar-brand" href="/">Supermarket App</a>

    <div class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
            <li class="nav-item">
                <a class="nav-link text-light" href="/shopping">Back to Shopping</a>
            </li>

            <li class="nav-item">
                <a class="nav-link text-light" href="/cart">View Cart</a>
            </li>

            <li class="nav-item">
                <a class="nav-link text-light" href="/logout">Logout</a>
            </li>
        </ul>
    </div>
</nav>

<div class="container mt-5">
    <h2>Your Order History</h2>
    <hr>

    <% if (orders.length === 0) { %>
        <p>You have no past orders.</p>
    <% } else { %>

        <% orders.forEach(order => { %>
            <div class="card mb-4">
                <div class="card-header">
                    <strong>Order #<%= order.orderId %></strong> - 
                    <%= order.orderDate.toLocaleString() %>
                </div>

                <div class="card-body">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Image</th>
                                <th>Price</th>
                                <th>Qty</th>
                                <th>Total</th>
                            </tr>
                        </thead>

                        <tbody>
                            <% order.items.forEach(item => { %>
                                <tr>
                                    <td><%= item.productName %></td>
                                    <td><img src="/images/<%= item.image %>" width="60"></td>
                                    <td>$<%= item.price %></td>
                                    <td><%= item.quantity %></td>
                                    <td>$<%= (item.price * item.quantity).toFixed(2) %></td>
                                </tr>
                            <% }) %>
                        </tbody>
                    </table>

                    <!-- such that every of my order has its own receipt -->
                    <div class="d-flex justify-content-between align-items-center mt-3 px-2">
                        <h5><strong>Order Total: $<%= order.total %></strong></h5>

                        <a href="/download-receipt/<%= order.orderId %>" 
                            class="btn btn-success d-flex align-items-center gap-2">
                            <i class="bi bi-file-earmark-arrow-down"></i>Download Receipt
                        </a>

                    </div>

                </div>
            </div>
        <% }) %>

    <% } %>

</div>

</body>
</html>